<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="theme-color" content="#3b3e43"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no"/><title>15513 Malloclab - Jingcheng Wu</title><meta name="description" content="Malloclab task summay. Any disclosed details are subject to academic integrity policy."/><meta property="og:description" content="Malloclab task summay. Any disclosed details are subject to academic integrity policy."/>    <meta name="keywords" content="AI, NLP, CV, Industrial, Personal, CMU, UESTC"/><link rel="dns-prefetch" href="https://wu-jingcheng.github.io"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://wu-jingcheng.github.io"><link rel="icon" type="image/png" href="https://static.b3log.org/images/brand/solo-32.png"/><link rel="apple-touch-icon" href="https://static.b3log.org/images/brand/solo-32.png"><link rel="shortcut icon" type="image/x-icon" href="https://static.b3log.org/images/brand/solo-32.png"><meta name="copyright" content="B3log"/><meta http-equiv="Window-target" content="_top"/><meta property="og:locale" content="en_US"/><meta property="og:title" content="15513 Malloclab - Jingcheng Wu"/><meta property="og:site_name" content="Jingcheng Wu"/><meta property="og:url"      content="https://wu-jingcheng.github.io/articles/2020/06/29/1593405379989.html?"/><meta property="og:image" content="https://static.b3log.org/images/brand/solo-32.png"/><link rel="search" type="application/opensearchdescription+xml" title="15513 Malloclab - Jingcheng Wu" href="/opensearch.xml"><link href="https://wu-jingcheng.github.io/rss.xml" title="RSS" type="application/rss+xml" rel="alternate"/><link rel="manifest" href="https://wu-jingcheng.github.io/manifest.json">        <link rel="canonical" href="https://wu-jingcheng.github.io/articles/2020/06/29/1593405379989.html">        <link rel="stylesheet"
              href="https://wu-jingcheng.github.io/skins/nijigen/css/base.css?1594218092421"/>
            <link rel="prev" title="本科四年(bksn)这回事" href="https://wu-jingcheng.github.io/articles/2020/06/27/1593270891364.html">
    </head>
<body>
<div class="bg"></div>
<div class="bg bg--1"></div>
<div class="bg bg--2"></div>
<div class="bg bg--3"></div>
<div class="bg bg--4"></div>
<div class="bg bg--5"></div>
<header class="header">
    <div class="header__wrap">
        <a href="https://wu-jingcheng.github.io" rel="start" class="header__logo">
            <i class="icon__home"></i> Jingcheng Wu
        </a>

        <nav class="mobile__hidden header__nav">
            <a href="https://wu-jingcheng.github.io/tags.html" rel="section">
                <i class="icon__tags"></i> Tag Cloud
            </a>
            <a href="https://wu-jingcheng.github.io/archives.html">
                <i class="icon__inbox"></i> Archive
            </a>
            <a rel="archive" href="https://wu-jingcheng.github.io/links.html">
                <i class="icon__link"></i> Friend Links
            </a>
            <a rel="alternate" href="https://wu-jingcheng.github.io/rss.xml" rel="section">
                <i class="icon__rss"></i> RSS
            </a>
        </nav>

    </div>
</header>
<div class="header__m fn__none">
    <i class="icon__list fn__none" onclick="$(this).next().slideToggle()"></i>
    <main class="module__list fn__none"></main>
    <i class="icon__more" onclick="$(this).next().slideToggle()"></i>
    <main class="module__list">
        <ul>
            <li>
                <a href="https://wu-jingcheng.github.io/tags.html" rel="section">
                    <i class="icon__tags"></i> Tag Cloud
                </a>
            </li>
            <li>
                <a href="https://wu-jingcheng.github.io/archives.html">
                    <i class="icon__inbox"></i> Archive
                </a>
            </li>
            <li>
                <a rel="archive" href="https://wu-jingcheng.github.io/links.html">
                    <i class="icon__link"></i> Friend Links
                </a>
            </li>
            <li>
                <a rel="alternate" href="https://wu-jingcheng.github.io/rss.xml" rel="section">
                    <i class="icon__rss"></i> RSS
                </a>
            </li>
        </ul>
    </main>
</div>
<div class="main" id="pjax">
    
    <div class="content">
        <main id="articlePage">
            <div class="article-list">
                <div class="item item--active">
                    <time class="vditor-tooltipped vditor-tooltipped__n item__date"
                          aria-label="2020">
                        07
                        <span class="item__day">08</span>
                    </time>

                    <h2 class="item__title">
                        <a rel="bookmark" href="https://wu-jingcheng.github.io/articles/2020/06/29/1593405379989.html">
                            15513 Malloclab
                        </a>
                    </h2>

                    <div class="item__date--m fn__none">
                        <i class="icon__date"></i>
                        2020-07-08
                    </div>

                    <div class="ft__center">
                        <span class="tag">
                            <i class="icon__tags"></i>
                            <a rel="tag" href="https://wu-jingcheng.github.io/tags/15513">
                                15513</a>,
                            <a rel="tag" href="https://wu-jingcheng.github.io/tags/CMU">
                                CMU</a>,
                            <a rel="tag" href="https://wu-jingcheng.github.io/tags/C">
                                C</a>,
                            <a rel="tag" href="https://wu-jingcheng.github.io/tags/English">
                                English</a>
                        </span>
                            <a class="tag" href="https://wu-jingcheng.github.io/articles/2020/06/29/1593405379989.html#b3logsolocomments">
                                <i class="icon__comments"></i> <span data-uvstatcmt="1593405379989">0</span> Comment
                            </a>
                        <span class="tag">
                            <i class="icon__views"></i>
                        <span data-uvstaturl="https://wu-jingcheng.github.io/articles/2020/06/29/1593405379989.html">0</span> View
                        </span>
                    </div>

                    <div class="vditor-reset">
                        <h1 id="toc_h1_0">Malloclab</h1>
<h2 id="toc_h2_1">Beforehand Statement</h2>
<p>According to academic integrity policy presented on the course webpage:</p>
<p>I am subject to the following limits:</p>
<blockquote>
<p><strong>From Now and Into the Future:</strong></p>
<p>As a general principle, you may not provide detailed help with an assignment to students this semester or in future semesters for any of the above-listed courses (unless you are serving as a teaching assistant or instructor for the course.) The following are clarifications about which forms of aid are authorized and which are not. Note that they apply to <em>all</em> of the above listed courses and <em>from now and into the indefinite future</em>.</p>
<p><strong>Sharing:</strong> You <strong>may not</strong> supply a copy of a file or document to an individual student or via a public channel, such as a blog post.</p>
<p><strong>Providing access:</strong> <em>You <strong>may not</strong> have any of your solution files in unprotected directories or in unprotected code repositories, either by putting files in an unprotected location or by allowing protections to lapse. Be sure to store your work in protected directories, and log off when you leave an open cluster, to prevent others from copying your work. If you make use of a code repository, such as Github, make sure your work is kept private, even after you have left CMU.</em></p>
<p><em><strong>Coaching, Assisting, and Collaborating:</strong></em> You <strong>may not</strong> provide electronic, verbal, or written descriptions of code or other solution information.</p>
<ul>
<li>You <strong>may</strong> clarify ambiguities or vague points in class handouts or textbooks.</li>
<li>You <strong>may</strong> help others use the computer systems, networks, compilers, debuggers, profilers, code libraries, and other system facilities.</li>
<li>You <strong>may</strong> discuss and provide general, strategic advice about an assignment. Providing anything more detailed than a brief description or a block diagram is not allowed. Providing any kind of code or pseudo-code is not allowed. Providing explicit directions on how to assemble allowed blocks of code is forbidden.</li>
<li>You <strong>may</strong> provide suggestions of potential bugs based on high-level symptoms. Code-based debugging assistance is forbidden.</li>
</ul>
</blockquote>
<p>Therefore, this page would only discuss the lab and my solution in a brief and a rather vague way.</p>
<h2 id="toc_h2_2">Overview</h2>
<p><strong>The overall size of the script we are working on eventually goes up to ~1170 lines</strong></p>
<p>Malloclab can be divided into to 2 subtasks, which are marked as the checkpoint and the final. The basic idea is: we need to design allocators that have good enough performance in both utilizations and throughput. The full-score benchmarks for the checkpoint and the final are listed as follows:</p>
<table>
<thead>
<tr><th align="center">Phase</th><th align="center">Utilizations</th><th align="center">Throughput</th></tr>
</thead>
<tbody>
<tr><td align="center">Checkpoint</td><td align="center">58%</td><td align="center">80%</td></tr>
<tr><td align="center">Final</td><td align="center">74%</td><td align="center">90%</td></tr>
</tbody>
</table>
<p>A starter code, which has all implementations aside from block coalescing to realize an implicit free list allocator, is given. Basically, our task is to make it into an explicit free list allocator and then a segregated free list allocator to survive the checkpoint. Based on the checkpoint result, we are supposed to make some improvements to increase utilizations while maintaining a relatively high thru.</p>
<p>Anyway, I survived. And there are some funny points.</p>
<p>At the checkpoint, actually I didn't have full scores because of relatively low util, which is abnormal. After the checkpoint (ends up with 91.4 scores), I carefully looked into the code and debugged with a method named mm_checkheap(__LINE__), which is a heap checker to spot inconsistensies within the heap from different levels. My observation was that the free block counts from heap traversal and free lists are not matched. Eventually, I found out that the cause is that I set a improper if statement for mm_init(). My preliminary design is: mm_init() called when all list roots are null, which means free lists are empty. However, it is possible that a heap space has been intilized but run out of and left empty free lists. Hence, the init method is overly used and prologue/epilogue take up some space and lowers util.</p>
<p>At the final, there are more stories.</p>
<p>To earn full scores in the final, we are supposed to realize following strategies step by step.</p>
<ol>
<li>Eliminate footers of allocated block.</li>
<li>Decrease min block size from 32 to 16 bytes. To do so, we need to eliminate prev field and footer in 16-byte blocks.</li>
<li>(Optional) Compress headers. Actually after step 2, we are almost there and thereby can use fine tune to achieve it. In my case, I fine tuned the find fit strategy from first fit to better fit and expanded the extendsize each we request new heap space over chunksize (more precisely, 5*allocated_size).</li>
</ol>
<p>Things above altogether win full scores in the final.</p>
<p>Some hints: cgdb, heap checker and beforehand careful design are important.</p>
<p>Some funny things:</p>
<p>When I eliminated the footers, found out that always garbled bytes error while reallocing. Turned out that adjustment in get_payload_size is missed out and the offset of the eliminated footer size wasn't counted during the calculatioin and overwrote bytes in other blocks.</p>
<p>One stupid thing is: when I removed block footers for the first time, I removed all despite the size classes, which led to ~700 KOP thru.</p>
<p>The basic design can be demonstrated by my file header comment:</p>
<blockquote>
<ul>
<li>@file mm.c A heap space allocator.</li>
<li>@brief A 64-bit struct-based segregated free list memory allocator</li>
<li></li>
<li>15-213: Introduction to Computer Systems</li>
<li></li>
<li>This allocator is the malloclab result in 15513.</li>
<li></li>
<li>The heap space is maintained mainly by a block-oriented strategy. The space</li>
<li>is divided into blocks and their sizes, allocation status and the like are</li>
<li>encoded in their header/footer.</li>
<li></li>
<li>The allocator implements a segregated free list. It has an array of 16</li>
<li>pointers to free blocks. The 15 in front are roots of different size classes.</li>
<li>The last is the tail of the 16-byte class.</li>
<li></li>
<li>For finding fit blocks strategy, it utilizes a <code>better</code> fit algorithm. The</li>
<li>numbers of suitable blocks under scrutiny is confined by the const</li>
<li><code>max_find</code>, which is 3 when I handed in.</li>
<li></li>
<li>In each free list, block placements follow address ordered principle.</li>
<li></li>
<li>One interesting design is that when we request heap extension size that is</li>
<li>beyond the chunksize, the allocator makes the demand size quintuple to reduce</li>
<li>future extension operations.</li>
<li></li>
<li>Have fun!</li>
</ul>
</blockquote>
<h2 id="toc_h2_3">Dummy writeup (Readers may ignore, serves for personal use)</h2>
<p>The whole writeup is given in a very ambiguous way. Therefore, the primary thing to do is to figure out what are our real tasks. For checkpoint, our handin is graded by:</p>
<ol>
<li><strong>Autograding</strong>: We are supposed to reach beyond 58% ratio in utilization and 80% in throughput to win all autograding scores at the checkpoint phase.</li>
<li><strong>Heap Checker</strong>: This is primarily graded with the function <strong>mm_checkheap</strong>, which is used to check the consistency of the heap.</li>
</ol>
<h3 id="toc_h3_4">Some important concepts that are not covered in lectures</h3>
<ul>
<li>Chunk and chunk_size: chunk is a memory space and chunk size if predefined, by which we extend the heap space.</li>
<li>Prologue footer and epilogue header: they are to pad the current chunk and the next chunk so that the blocks inside the chunks are able to be 16-byte aligned.</li>
</ul>
<h3 id="toc_h3_5">Checkpoint</h3>
<p>Grading is based on the autograding of the allocator overhead vs. standard one and heap checker.</p>
<h3 id="toc_h3_6">Final</h3>
<p>...</p>
                    </div>
                </div>
            </div>

                <div class="module mobile__hidden">
                    <div class="module__content fn__clear">
                            <a href="https://wu-jingcheng.github.io/articles/2020/06/27/1593270891364.html" rel="prev" class="fn__left breadcrumb">
                                Previous: 本科四年(bksn)这回事
                            </a>
                    </div>
                </div>

                <div class="module mobile__hidden fn__none">
                    <div class="module__content">
                        <a href="https://wu-jingcheng.github.io/articles/2020/06/27/1593270891364.html" rel="prev" class="breadcrumb">
                            Previous: 本科四年(bksn)这回事
                        </a>
                    </div>
                </div>

                <div id="b3logsolocomments"></div>
                <div id="vcomment" class="module__content"
                     style="border-radius: 5px;margin-bottom: 30px;box-shadow: 1px 1px 3px 1px rgba(0,0,0,0.2);transition: all .3s;"
                     data-name="WuJingcheng" data-postId="1593405379989"></div>

            <div class="fn__flex article__relevant">
                <div class="fn__flex-1" id="externalRelevantArticlesWrap">
                    <div class="module">
                        <div id="externalRelevantArticles" class="module__list"></div>
                    </div>
                </div>
                <div class="mobile__hidden">&nbsp; &nbsp; &nbsp; &nbsp;</div>
                <div class="fn__flex-1" id="randomArticlesWrap">
                    <div class="module">
                        <div id="randomArticles" class="module__list"></div>
                    </div>
                </div>
                <div class="mobile__hidden">&nbsp; &nbsp; &nbsp; &nbsp;</div>
                <div class="fn__flex-1" id="relevantArticlesWrap">
                    <div class="module">
                        <div id="relevantArticles" class="module__list"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>
<aside class="side">
        <div class="module">
            <div class="module__list">
<ul class="article__toc">
        <li class="toc__h1">
            <a href="#toc_h1_0">Malloclab</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_1">Beforehand Statement</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_2">Overview</a>
        </li>
        <li class="toc__h2">
            <a href="#toc_h2_3">Dummy writeup (Readers may ignore, serves for personal use)</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_4">Some important concepts that are not covered in lectures</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_5">Checkpoint</a>
        </li>
        <li class="toc__h3">
            <a href="#toc_h3_6">Final</a>
        </li>
</ul>            </div>
        </div>
        <section class="vditor-reset module">
            <main class="module__content">
                Incoming Graduate Student @ MSAII, CMU; 
Received (double degrees) BEng of Electronic Information Engineering and BMgmt of E commerce @ UESTC
            </main>
        </section>


    <div class="module item">
        <header class="module__header ft__center">
            WuJingcheng
        </header>
        <main class="module__content ft__center">
            <img class="side__avatar" src="https://b3logfile.com/avatar/1587746221791_1592839616748.jpeg?imageView2/1/w/128/h/128/interlace/0/q/100" alt="WuJingcheng"/>
            contact: wu_jingcheng@qq.com <br> <br>
    <a href="https://hacpai.com/member/WuJingcheng"
       title="https://hacpai.com/member/WuJingcheng"
       class="user__site"
       target="_blank" rel="noopener nofollow">
        <svg viewBox="0 0 32 32" width="100%" height="100%">
            <path fill="#d23f31" style="fill: var(--color1, #d23f31)" d="M5.787 17.226h17.033l5.954 9.528c0.47 0.752 0.003 1.361-1.042 1.361h-15.141z"></path>
            <path d="M10.74 3.927h17.033c1.045 0 1.512 0.609 1.042 1.361l-5.954 9.528h-19.872l6.379-10.209c0.235-0.376 0.849-0.681 1.372-0.681z"></path>
            <path d="M2.953 17.226h2.839l6.804 10.889h-1.892c-0.523 0-1.137-0.305-1.372-0.681z"></path>
        </svg>
    </a>

        <a href="https://github.com/Wu-Jingcheng"
           title="https://github.com/Wu-Jingcheng"
           class="user__site"
           target="_blank" rel="noopener nofollow">
            <svg viewBox="0 0 32 32" width="100%" height="100%">
                <path d="M16 0.331c-8.836 0-16 7.163-16 16 0 7.069 4.585 13.067 10.942 15.182 0.8 0.148 1.094-0.347 1.094-0.77 0-0.381-0.015-1.642-0.022-2.979-4.452 0.968-5.391-1.888-5.391-1.888-0.728-1.849-1.776-2.341-1.776-2.341-1.452-0.993 0.11-0.973 0.11-0.973 1.606 0.113 2.452 1.649 2.452 1.649 1.427 2.446 3.743 1.739 4.656 1.33 0.143-1.034 0.558-1.74 1.016-2.14-3.554-0.404-7.29-1.777-7.29-7.907 0-1.747 0.625-3.174 1.649-4.295-0.166-0.403-0.714-2.030 0.155-4.234 0 0 1.344-0.43 4.401 1.64 1.276-0.355 2.645-0.532 4.005-0.539 1.359 0.006 2.729 0.184 4.008 0.539 3.054-2.070 4.395-1.64 4.395-1.64 0.871 2.204 0.323 3.831 0.157 4.234 1.026 1.12 1.647 2.548 1.647 4.295 0 6.145-3.743 7.498-7.306 7.895 0.574 0.497 1.085 1.47 1.085 2.963 0 2.141-0.019 3.864-0.019 4.391 0 0.426 0.288 0.925 1.099 0.768 6.354-2.118 10.933-8.113 10.933-15.18 0-8.837-7.164-16-16-16z"></path>
            </svg>
        </a>

        </main>
    </div>


        <div class="module item">
            <header class="module__header">Tags</header>
            <main class="module__content--three module__content fn__clear">
                    <a rel="tag"
                       href="https://wu-jingcheng.github.io/tags/English"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="3 PostsArticle">
                        English</a>
                    <a rel="tag"
                       href="https://wu-jingcheng.github.io/tags/CMU"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="2 PostsArticle">
                        CMU</a>
                    <a rel="tag"
                       href="https://wu-jingcheng.github.io/tags/15513"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="2 PostsArticle">
                        15513</a>
                    <a rel="tag"
                       href="https://wu-jingcheng.github.io/tags/C"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="2 PostsArticle">
                        C</a>
                    <a rel="tag"
                       href="https://wu-jingcheng.github.io/tags/Personal"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="2 PostsArticle">
                        Personal</a>
                    <a rel="tag"
                       href="https://wu-jingcheng.github.io/tags/Chinese"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="2 PostsArticle">
                        Chinese</a>
                    <a rel="tag"
                       href="https://wu-jingcheng.github.io/tags/LeetCode"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 PostsArticle">
                        LeetCode</a>
                    <a rel="tag"
                       href="https://wu-jingcheng.github.io/tags/Coding"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 PostsArticle">
                        Coding</a>
                    <a rel="tag"
                       href="https://wu-jingcheng.github.io/tags/Java"
                       class="tag vditor-tooltipped vditor-tooltipped__n"
                       aria-label="1 PostsArticle">
                        Java</a>
            </main>
        </div>

    <div class="module item">
        <div class="module__header">
            <div class="fn__flex">
                <a href="https://wu-jingcheng.github.io/archives.html" class="fn__flex-1 ft__center">
                    5
                    Article
                </a>
            </div>
            <br/>
            <div class="fn__flex">
                <div class="fn__flex-1 ft__center">
                    <span data-uvstaturl="https://wu-jingcheng.github.io">0</span> <span class="ft-gray">View</span>
                </div>
            </div>
        </div>
    </div>
</aside>
    
</div>
</div>
<div class="icon__up" onclick="Util.goTop()"></div>
<footer class="footer">
    &copy; 2020
    <a href="https://wu-jingcheng.github.io">Jingcheng Wu</a>
    
    <div class="fn__none"></div>
</footer>
<div class="icon-up" onclick="Util.goTop()"></div>

<script>
  var Label = {
    servePath: "https://wu-jingcheng.github.io",
    staticServePath: "https://wu-jingcheng.github.io",
    luteAvailable: false,
    hljsStyle: 'github',
    langLabel: "en_US",
    version: "4.1.0",
    staticSite: true,
    showCodeBlockLn: false,
  }
</script>
<script type="text/javascript" src="https://wu-jingcheng.github.io/skins/nijigen/js/common.min.js?1594218092421" charset="utf-8"></script>


<script type="text/javascript">
    Util.addScript('https://wu-jingcheng.github.io/js/page.min.js?1594218092421', 'soloPageScript')
    var page = new Page({
        "commentContentCannotEmptyLabel": "Sorry, your content must be between 2 and 500 characters long.",
        "oId": "1593405379989",
        "blogHost": "https://wu-jingcheng.github.io",
        "randomArticles1Label": "Random Articles:",
        "externalRelevantArticles1Label": "External Relevant Articles:"
    });
    $(document).ready(function () {
        page.load();
    page.tips.externalRelevantArticlesDisplayCount = "0";
    Skin.initArticle()
    });
</script>

</body>
</html>

<!-- Generated by Latke (https://github.com/88250/latke) in 33ms, 2020/07/08 23:19:55 -->